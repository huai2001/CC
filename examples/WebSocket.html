<!DOCTYPE HTML>
<html>
   <head>
   <meta charset="utf-8">
   <title>WebSocket</title>
    
      <script type="text/javascript">
         let index = 0;
         let ws = null;
         function WebSocketTest() {
            let text = document.getElementById('text');
            if ("WebSocket" in window) {
               
               // 打开一个 web socket
               ws = new WebSocket("ws://127.0.0.1:8088/abc");
                
               ws.onopen = function() {
                  // Web Socket 已连接上，使用 send() 方法发送数据
                  index = 0;
                  if (text) {
                     text.innerHTML = "Web Socket 已连接上...";
                  }
               };
                
               ws.onmessage = function (evt) { 
                  var received_msg = evt.data;
                  if (text) {
                     text.innerHTML = "Web Socket 数据已接收: "+received_msg
                  }
               };
                
               ws.onclose = function() { 
                  // 关闭 websocket
                  if (text) {
                     text.innerHTML = "Web Socket 连接已关闭...";
                  }
                  ws = null;
               };
            }
            
            else
            {
               // 浏览器不支持 WebSocket
               alert("您的浏览器不支持 WebSocket!");
            }
         }

         function WebSocketSend() {
            if (ws) {
               ws.send("testes:"+(index++));
            }
         }

         function WebSocketClose() {
            if (ws) {
               ws.close();
               ws = null;
               if (text) {
                  text.innerHTML = "Web Socket 连接已关闭...";
               }
            }
         }
      </script>
        
   </head>
   <body>
      <div id="text"></div>
      <div id="sse">
         <a href="javascript:WebSocketTest()">运行 WebSocket</a>
         <br/>
         <a href="javascript:WebSocketSend()">发送 WebSocket</a>
         <br/>
         <a href="javascript:WebSocketClose()">关闭 WebSocket</a>
      </div>
      
   </body>
</html>